# EA√≠ Agent Gateway - Environment Configuration Example
# Copy this file to .env and fill in the required values

# ==============================================================================
# REQUIRED VARIABLES (Must be set)
# ==============================================================================

# Core Application
APP_PREFIX=dev_eai_gateway

# Message Queue (RabbitMQ)
RABBITMQ_URL=amqp://guest:guest@localhost:5672/

# Redis
REDIS_DSN=redis://localhost:6379/0
REDIS_BACKEND=redis://localhost:6379/1

# Google Cloud Configuration
# REASONING_ENGINE_ID can be overridden per request by passing "reasoning_engine_id" in the request body
# This is useful for development, testing, or multi-tenant scenarios
REASONING_ENGINE_ID=your-reasoning-engine-id
PROJECT_ID=your-gcp-project-id
PROJECT_NUMBER=your-gcp-project-number
LOCATION=us-central1
SERVICE_ACCOUNT=/path/to/service-account.json
GCS_BUCKET=your-gcs-bucket

# EAI Agent Service
EAI_AGENT_URL=https://your-eai-agent-service.com
EAI_AGENT_TOKEN=your-eai-agent-token

# AI Models
LLM_MODEL=google_ai/gemini-2.5-flash-lite
EMBEDDING_MODEL=google_ai/text-embedding-004

# ==============================================================================
# OPTIONAL VARIABLES (Have defaults)
# ==============================================================================

# HTTP Server
SERVER_PORT=8000
SERVER_HOST=0.0.0.0
SERVER_READ_TIMEOUT=30s
SERVER_WRITE_TIMEOUT=30s
SERVER_IDLE_TIMEOUT=120s

# Concurrency
MAX_PARALLEL=8

# Message Queue Configuration
RABBITMQ_EXCHANGE=eai_gateway
RABBITMQ_USER_QUEUE=user_messages
RABBITMQ_AGENT_QUEUE=agent_messages
RABBITMQ_DLX_EXCHANGE=eai_gateway_dlx
RABBITMQ_MAX_RETRIES=3
RABBITMQ_RETRY_DELAY=30

# Worker Timeouts (from legacy Celery config)
CELERY_SOFT_TIME_LIMIT=90
CELERY_TIME_LIMIT=120

# Redis TTL Settings
REDIS_TASK_RESULT_TTL=120s
REDIS_TASK_STATUS_TTL=600s
CACHE_TTL_SECONDS=720s
AGENT_ID_CACHE_TTL=86400s

# Redis Connection Pool Settings
REDIS_POOL_SIZE=20
REDIS_MIN_IDLE_CONNECTIONS=5
REDIS_MAX_IDLE_CONNECTIONS=10
REDIS_CONNECTION_MAX_IDLE_TIME=300
REDIS_CONNECTION_MAX_LIFETIME=3600
REDIS_DIAL_TIMEOUT=5
REDIS_READ_TIMEOUT=3
REDIS_WRITE_TIMEOUT=3

# Google API Rate Limiting
GOOGLE_API_RATE_LIMIT_ENABLED=false
GOOGLE_API_MAX_REQUESTS_PER_MINUTE=60
GOOGLE_API_BACKOFF_MULTIPLIER=2.0
GOOGLE_API_MAX_BACKOFF_SECONDS=300
GOOGLE_API_MIN_BACKOFF_SECONDS=1

# Google Agent Engine Timeouts
GOOGLE_AGENT_ENGINE_REQUEST_TIMEOUT=1800s
GOOGLE_AGENT_ENGINE_MAX_RETRIES=3
GOOGLE_AGENT_ENGINE_RETRY_BACKOFF=1s

# Google Agent Engine Health Check Configuration
# Cache health check results to avoid hammering Google APIs
# Cache is invalidated when REASONING_ENGINE_ID changes
GOOGLE_AGENT_ENGINE_HEALTH_CHECK_CACHE_TTL=30s
GOOGLE_AGENT_ENGINE_HEALTH_CHECK_TIMEOUT=3s
GOOGLE_AGENT_ENGINE_HEALTH_CHECK_MAX_RETRIES=2
GOOGLE_AGENT_ENGINE_HEALTH_CHECK_RETRY_DELAY=500ms

# Google Agent Engine Graceful Error Messages (pt-BR)
# Customize these messages for your users
GOOGLE_AGENT_ENGINE_ERROR_MSG_UNAVAILABLE="ü§ñ Nosso servi√ßo de IA est√° temporariamente indispon√≠vel. Por favor, tente novamente em alguns instantes."
GOOGLE_AGENT_ENGINE_ERROR_MSG_TIMEOUT="‚è±Ô∏è A resposta est√° demorando mais do que o esperado. Por favor, tente novamente."
GOOGLE_AGENT_ENGINE_ERROR_MSG_DEFAULT="‚ùå Desculpe, ocorreu um erro ao processar sua mensagem. Por favor, tente novamente."

# Audio Transcription
TRANSCRIBE_MAX_DURATION=60
TRANSCRIBE_ALLOWED_URLS=https://whatsapp.dados.rio/

# EAI Agent Configuration
EAI_AGENT_CONTEXT_WINDOW_LIMIT=1000000
EAI_AGENT_MAX_GOOGLE_SEARCH_PER_STEP=1

# Observability - OpenTelemetry
OTEL_ENABLED=true
OTEL_COLLECTOR_URL=http://localhost:4317
OTEL_SERVICE_NAME=eai-gateway
OTEL_SERVICE_VERSION=0.1.0
OTEL_ENVIRONMENT=development

# Observability - Metrics
METRICS_ENABLED=true
METRICS_PORT=8080
METRICS_PATH=/metrics

# Observability - Logging
LOG_LEVEL=info
LOG_FORMAT=json
LOG_OUTPUT=stdout

# Observability - Health Checks
HEALTH_CHECK_TIMEOUT=10s
READINESS_CHECK_TIMEOUT=5s

# Security
CORS_ENABLED=true
CORS_ORIGINS=*
MAX_REQUEST_SIZE=10485760
RATE_LIMIT_ENABLED=false
RATE_LIMIT_REQUESTS=100

# Callback Configuration
CALLBACK_ENABLED=true
CALLBACK_TIMEOUT=10
CALLBACK_MAX_RETRIES=3
CALLBACK_ENABLE_HMAC=false
CALLBACK_HMAC_SECRET=
CALLBACK_REQUIRE_HTTPS=true
CALLBACK_ALLOWED_DOMAIN=

# Callback Authentication (Optional - if not set, callbacks work without auth)
# Used for Bearer Token authentication when calling webhook callback URLs
CALLBACK_AUTH_TOKEN=

# Data Relay - Error Interceptor
# Sends callback failure errors to Data Relay for monitoring and alerting
DATA_RELAY_ENABLED=false
DATA_RELAY_BASE_URL=https://your-data-relay-service.com
DATA_RELAY_API_KEY=your-data-relay-api-key
DATA_RELAY_TIMEOUT=10
DATA_RELAY_SOURCE=eai-agent-gateway
DATA_RELAY_FLOW_NAME=wetalkie_callback